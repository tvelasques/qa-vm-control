<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle VM QA - Europlus</title>
  <link rel="icon" type="image/png" href="data:image/png;base64,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">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0066B3 0%, #004c8c 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      border-top: 6px solid #00D563;
    }

    .logo-section {
      margin-bottom: 30px;
    }

    h1 {
      color: #0066B3;
      margin-bottom: 5px;
      font-size: 28px;
      font-weight: 600;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
      font-weight: 500;
    }

    .status-container {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      border: 2px solid #0066B3;
      position: relative;
      overflow: hidden;
    }

    .status-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #0066B3 0%, #00D563 100%);
    }

    .status-label {
      color: #0066B3;
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    #status {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .status-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      animation: pulse 2s infinite;
    }

    .status-icon.loading {
      background: #ffc107;
    }

    .status-icon.running {
      background: #00D563;
    }

    .status-icon.stopped {
      background: #dc3545;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-running {
      color: #00D563;
    }

    .status-stopped {
      color: #dc3545;
    }

    .status-loading {
      color: #6c757d;
    }

    .button-container {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      min-width: 140px;
      padding: 15px 30px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-ligar {
      background: linear-gradient(135deg, #00D563 0%, #00b350 100%);
      color: white;
    }

    .btn-ligar:hover:not(:disabled) {
      background: linear-gradient(135deg, #00b350 0%, #009943 100%);
    }

    .btn-desligar {
      background: linear-gradient(135deg, #0066B3 0%, #004c8c 100%);
      color: white;
    }

    .btn-desligar:hover:not(:disabled) {
      background: linear-gradient(135deg, #004c8c 0%, #003d70 100%);
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-left: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .message {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .message.success {
      background: #d4f4dd;
      color: #0d5b23;
      border: 1px solid #00D563;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .footer {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #e9ecef;
      color: #6c757d;
      font-size: 12px;
    }

    .europlus-badge {
      display: inline-block;
      background: linear-gradient(135deg, #0066B3 0%, #004c8c 100%);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 1px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-section">
      <h1>üñ•Ô∏è VM QA - Controle</h1>
      <p class="subtitle">Europlus Viagens e Turismo</p>
    </div>

    <div class="status-container">
      <div class="status-label">Status da M√°quina Virtual</div>
      <div id="status">
        <span class="status-icon loading"></span>
        <span>Carregando...</span>
      </div>
    </div>

    <div class="button-container">
      <button id="btnLigar" class="btn-ligar" onclick="ligar()">
        ‚ñ∂Ô∏è Ligar VM
      </button>
      <button id="btnDesligar" class="btn-desligar" onclick="desligar()">
        ‚èπÔ∏è Desligar VM
      </button>
    </div>

    <div id="message" class="message"></div>

    <div class="footer">
      <div>√öltima atualiza√ß√£o: <span id="lastUpdate">-</span></div>
      <div class="europlus-badge">EUROPLUS</div>
    </div>
  </div>

  <script>
    const functionUrl = "https://fn-start-stop-vm-qa-ffc5dfe7cagjanf7.brazilsouth-01.azurewebsites.net/api/HttpTrigger1?code=tUENmIsJSDsnzd9BpnOMCu1dEW6YgJQLl1q7K9QjIToVAzFueBwKrg==";
    
    let isLoading = false;

    function updateLastUpdate() {
      const now = new Date();
      document.getElementById('lastUpdate').innerText = now.toLocaleTimeString('pt-BR');
    }

    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.innerText = text;
      messageEl.className = `message ${type}`;
      messageEl.style.display = 'block';
      
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 5000);
    }

    function setLoading(loading) {
      isLoading = loading;
      document.getElementById('btnLigar').disabled = loading;
      document.getElementById('btnDesligar').disabled = loading;
    }

    async function obterStatus() {
      try {
        setLoading(true);
        const statusEl = document.getElementById('status');
        
        const res = await fetch(functionUrl + "&action=status");
        
        if (!res.ok) {
          throw new Error('Erro ao buscar status');
        }
        
        const data = await res.json();
        const status = data.status || 'desconhecido';
        
        // Atualiza o √≠cone e texto baseado no status
        let iconClass = 'loading';
        let statusClass = 'status-loading';
        let statusText = 'Desconhecido';
        
        if (status.toLowerCase().includes('running') || status.toLowerCase().includes('ligad')) {
          iconClass = 'running';
          statusClass = 'status-running';
          statusText = 'üü¢ Ligada';
        } else if (status.toLowerCase().includes('stopped') || status.toLowerCase().includes('desligad')) {
          iconClass = 'stopped';
          statusClass = 'status-stopped';
          statusText = 'üî¥ Desligada';
        } else if (status.toLowerCase().includes('deallocat')) {
          iconClass = 'stopped';
          statusClass = 'status-stopped';
          statusText = 'üî¥ Desalocada';
        }
        
        statusEl.innerHTML = `
          <span class="status-icon ${iconClass}"></span>
          <span class="${statusClass}">${statusText}</span>
        `;
        
        updateLastUpdate();
      } catch (error) {
        console.error('Erro ao obter status:', error);
        document.getElementById('status').innerHTML = `
          <span class="status-icon stopped"></span>
          <span class="status-stopped">Erro ao carregar</span>
        `;
        showMessage('Erro ao buscar status da VM', 'error');
      } finally {
        setLoading(false);
      }
    }

    async function ligar() {
      if (isLoading) return;
      
      try {
        setLoading(true);
        showMessage('Iniciando VM... Isso pode levar alguns minutos.', 'success');
        
        const res = await fetch(functionUrl + "&action=start");
        
        if (!res.ok) {
          throw new Error('Erro ao ligar VM');
        }
        
        showMessage('‚úÖ Comando enviado! A VM est√° sendo ligada...', 'success');
        
        // Aguarda 10 segundos e verifica o status
        setTimeout(obterStatus, 10000);
      } catch (error) {
        console.error('Erro ao ligar VM:', error);
        showMessage('‚ùå Erro ao ligar a VM. Tente novamente.', 'error');
        obterStatus();
      }
    }

    async function desligar() {
      if (isLoading) return;
      
      try {
        setLoading(true);
        showMessage('Desligando VM... Isso pode levar alguns minutos.', 'success');
        
        const res = await fetch(functionUrl + "&action=stop");
        
        if (!res.ok) {
          throw new Error('Erro ao desligar VM');
        }
        
        showMessage('‚úÖ Comando enviado! A VM est√° sendo desligada...', 'success');
        
        // Aguarda 10 segundos e verifica o status
        setTimeout(obterStatus, 10000);
      } catch (error) {
        console.error('Erro ao desligar VM:', error);
        showMessage('‚ùå Erro ao desligar a VM. Tente novamente.', 'error');
        obterStatus();
      }
    }

    // Carrega o status inicial
    obterStatus();
    
    // Atualiza o status a cada 30 segundos
    setInterval(obterStatus, 30000);
  </script>
</body>
</html>
